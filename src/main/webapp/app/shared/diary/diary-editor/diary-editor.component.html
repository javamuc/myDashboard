@if (isEditorOpen()) {
  <div class="diary-overlay" (click)="onOverlayClick($event)">
    <div class="diary-content" (click)="onContentClick($event)">
      <div class="diary-header">
        <h2>Mood Tracker & Diary</h2>
        <button class="close-button" (click)="closeEditor()">
          <fa-icon icon="times"></fa-icon>
        </button>
      </div>

      <!-- Emoticon Selector (initial state) -->
      @if (!isTagSelectorOpen()) {
        <jhi-diary-emoticon-selector
          [selectedEmoticon]="selectedEmoticon()"
          [selectionConfirmed]="false"
          (emoticonSelected)="selectEmoticon($event)"
          (nextClicked)="openTagSelector()"
        >
        </jhi-diary-emoticon-selector>
      }

      <!-- Combined Emoticon and Tag Selector (after emoticon selection) -->
      @if (isTagSelectorOpen()) {
        <div class="combined-selector">
          <div class="selected-emoticon">
            <div class="emoticon-emoji">{{ selectedEmoticon()?.emoji }}</div>
          </div>
          <jhi-diary-tag-selector
            [selectedTags]="selectedTags()"
            (tagToggled)="toggleTag($event)"
            (tagAdded)="addNewTag($event)"
            (enterPressed)="startNewEntry()"
            (escapePressed)="closeTagSelector()"
          >
          </jhi-diary-tag-selector>
        </div>
      }

      <!-- Entry Input (appears only after tags are selected) -->
      @if (selectedEmoticon() && selectedTags().length > 0 && !isTagSelectorOpen() && !isEditingEntry()) {
        <div class="entry-input-container">
          <div class="entry-content-layout">
            <div class="entry-sidebar">
              <div class="selected-emoticon-large">
                {{ selectedEmoticon()?.emoji }}
              </div>
              <div class="selected-tags-sidebar">
                @for (tag of selectedTags(); track tag.id) {
                  <div class="selected-tag">{{ tag.name }}</div>
                }
              </div>
            </div>
            <div class="entry-main">
              <textarea
                #entryInput
                [ngModel]="entryContent()"
                (ngModelChange)="entryContent.set($event)"
                placeholder="Text Area"
                class="entry-input"
              ></textarea>
              <div class="entry-actions">
                <button class="save-button" (click)="createEntry()">
                  Save
                  <div class="save-shortcut">Cmd+Enter</div>
                </button>
              </div>
            </div>
          </div>
        </div>
      }

      <!-- Edit Entry Input (appears when editing an existing entry) -->
      @if (isEditingEntry()) {
        <div class="entry-input-container">
          <textarea
            #entryInput
            [ngModel]="entryContent()"
            (ngModelChange)="entryContent.set($event)"
            placeholder="Edit your entry... (Press âŒ˜+Enter to save)"
            class="entry-input"
          ></textarea>
          <div class="entry-actions">
            <button class="save-button" (click)="saveEditedEntry()"><fa-icon icon="save"></fa-icon> Save</button>
            <button class="cancel-button" (click)="cancelEditing()"><fa-icon icon="times"></fa-icon> Cancel</button>
          </div>
        </div>
      }
    </div>
  </div>
}
