@if (activeBoard(); as board) {
  <div class="board-container">
    <div class="board-header">
      <h1>{{ board.title }}</h1>

      <div class="board-controls">
        <div class="search-box">
          <input type="text" placeholder="Search tasks..." (input)="onSearchInput($event)" />
        </div>

        <div class="filter-sort">
          <div class="dropdown">
            <button (click)="filterMenuOpen.set(!filterMenuOpen())" [class.active]="filterMenuOpen()">
              <fa-icon [icon]="['fas', 'filter']"></fa-icon>
              Filter
            </button>
            @if (filterMenuOpen()) {
              <div class="dropdown-menu">
                <div class="dropdown-item" *ngFor="let property of taskProperties" (click)="addFilter(property, '')">
                  {{ property }}
                </div>
              </div>
            }
          </div>

          <div class="dropdown">
            <button (click)="sortMenuOpen.set(!sortMenuOpen())" [class.active]="sortMenuOpen()">
              <fa-icon [icon]="['fas', 'sort']"></fa-icon>
              Sort
            </button>
            @if (sortMenuOpen()) {
              <div class="dropdown-menu">
                <div class="dropdown-item" *ngFor="let property of taskProperties" (click)="setSort(property)">
                  {{ property }}
                  @if (boardView().sort?.property === property) {
                    <fa-icon [icon]="['fas', boardView().sort?.direction === 'asc' ? 'arrow-up' : 'arrow-down']"></fa-icon>
                  }
                </div>
              </div>
            }
          </div>
        </div>

        <button class="new-task-btn" (click)="createNewTask($event)">
          <fa-icon [icon]="['fas', 'plus']"></fa-icon>
          New
        </button>
      </div>

      @if (boardView().filters.length > 0) {
        <div class="active-filters">
          <div class="filter-tag" *ngFor="let filter of boardView().filters; let i = index">
            {{ filter.property }}: {{ filter.value }}
            <fa-icon [icon]="['fas', 'times']" (click)="removeFilter(i)"></fa-icon>
          </div>
        </div>
      }
    </div>

    <!-- Board Content -->
    <div class="board-content">
      @for (status of statuses; track status) {
        <div class="column">
          <div class="column-header">
            <h2>{{ status }}</h2>
            <span class="task-count">{{ getTaskCount(status) }}</span>
          </div>
          <div
            class="column-content"
            cdkDropList
            [id]="status + '-list'"
            [cdkDropListData]="tasksByStatus().get(status) ?? []"
            [cdkDropListConnectedTo]="getConnectedLists(status)"
            (cdkDropListDropped)="onDrop($event, status)"
          >
            @for (task of tasksByStatus().get(status) ?? []; track task.id) {
              <div cdkDrag [cdkDragData]="task">
                <jhi-task-card [task]="task"></jhi-task-card>
              </div>
            }
          </div>
        </div>
      }
    </div>
  </div>
} @else {
  <div class="no-boards">
    <h2>No boards found</h2>
    <p>Create a new board to get started</p>
  </div>
}
